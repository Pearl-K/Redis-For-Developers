# Session Store로서 레디스의 기능
## 세션 스토어가 필요한 이유
- 세션 객체는 Stateful 하다는 특징이 있다.
- 해당 문제 때문에 원활한 scale-out이 불가능하다.
    - 특정 세션이 특정 서버에 종속된다고 생각하면 됨


## 세션 공유 저장소로 레디스 사용하기
- 그렇다고 서버의 세션 객체 전부를 공유 저장소에 저장할 필요는 없다.
- 서버 간 relay에 필요한 정보만 담아서 저장하면 된다.
- 단순한 방식으로는 String 으로 저장할 수도 있으나, 필드 별 접근과 수정이 용이한 Hash 자료구조가 더 적합하다.
- 보통 서버들 사이에 메시지 브로커를 끼워 넣어 relay 동작에서 장애 전파와 서버 간 종속성을 막는 경우가 많다.
- 단, 세션을 잃어버릴 위험이 있기 때문에 레디스 운영에 주의해야 한다.

---
## 세션을 사용하는 서버 확장 시, 왜 메시지 브로커를 두는지
![network-topology](/chapter-05/img/network-topology.png)


위 그림은 전형적인 카프카 Producer/Consumer 구조에서 따온 네트워크 토폴로지를 나타낸다.

가운데에 브로커가 얼마나 서버간 연결 종속성과 네트워크 구조를 단순하게 해주는지 한 눈에 볼 수 있다.

서버 증감에도 매우 용이하며, 장애 전파가 연쇄적으로 일어나는 것을 막을 수 있는 것도 유용하다.


---
## Ref.
- [WebSocket 세션 객체와 스케일 아웃 확장 시 문제점](https://pearlb1ue.tistory.com/90)