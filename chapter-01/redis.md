# Redis
Remote Dictionary Server의 약자로, 고성능 KV 유형의 인메모리 NoSQL 데이터베이스이다.


---
## Redis 특징
### 1. 실시간 응답(빠른 성능)
빠른 응답과 성능은 InMemory 특성에서 나온다. 기존의 Disk 기반 데이터베이스와의 IO 성능 차이가 있다.

HDD, SSD 같은 디스크와 RAM에 접근하는 시간, 성능 차이를 비교해보자.


### 2. 단순성
KV 형태로 데이터를 저장, 관리하면서도 키에 매핑되는 값에 다양한 자료구조를 지원하고 있다.

String, Hash, Set 등을 지원하여 추가적인 데이터 가공이나 처리 없이 애플리케이션에서 자료구조와 연계하여 쉽게 활용할 수 있다.

임피던스 불일치(Impedance Mismatch) 문제가 크지 않다.

    서로 다른 두 계층(ex. 애플리케이션의 객체 모델과 데이터베이스의 저장 모델) 사이에 표현·구조·행동의 차이 때문에 생기는 문제


### 3. 고가용성
- 자체적으로 HA 기능을 제공한다.
- 복제를 통해 데이터를 여러 서버에 분산 시키거나, 센티널을 통해 자동 failover를 지원한다.


### 4. 확장성
- 클러스터 모드를 사용하여 손쉬운 수평 확장이 가능하다.
- 데이터는 레디스 클러스터 안에서 자동 샤딩(Hash)된 후 저장되며, 여러 복제본이 생성되기도 한다.
- 클러스터 버스라는 프로토콜을 이용해 서로 감시하고 있으며, 마스터 노드에 문제가 생기면 자동 failover하는 구조이다.


### 5. 클라우드 네이티브 - 멀티 클라우드
- 클라우드 네이티브 서비스에서 빠른 데이터 액세스와 처리를 담당하는 역할로 적합하다. (특히, MSA에서)
- 멀티 클라우드는 여러 클라우드 제공업체 서비스를 활용하는 전략이다.
    - 여러 클라우드 서비스 제공자의 강점을 혼합해서 사용할 수도 있다.
    - ex. Amazon ElastiCache for Redis, Google Cloud Memory Store for Redis 등


### 6. 사용시 주의점
- 이벤트 루프 기반의 싱글 스레드로 동작한다.
    - 정확히는 메인 스레드 1개와 별도 스레드 3개 = 총 4개로 구성되어 있다.
    - 하지만, 클라이언트의 커맨드를 처리하는 부분은 이벤트 루프 기반으로 싱글 스레드로 동작한다.
    - 이로 인해, 하나의 코어만 있는 서버에서도 레디스를 사용할 수 있다.
- 그러나 싱글 스레드로 생기는 병목(특정 커맨드 지연)을 주의해야 한다.
- 또한, 인메모리 DB이므로 적절한 처리 없이 서버가 꺼지면 메모리 내용을 잃을 수도 있으므로 조심하자.


---
## MSA와 Redis
### 1. 데이터 저장소로서의 역할
MSA 환경에서 각 서비스별 개별 저장소로 사용하기 적합하다.
설치가 간단하고, 최소한의 리소스로 많은 처리량을 낼 수 있으며, 다양한 자료구조를 지원하기 때문에 마이크로서비스에 딱 맞는 데이터를 저장하기 편하다.


데이터 영속성 문제가 걱정된다면, AOF(Append Only File)이나 RDB 형식의 주기적인 Disk Flush를 사용하여 저장할수도 있다.


레디스에 장애가 발생해 데이터가 유실되더라도 백업 파일을 적절히 이용하면 다시 복구할 수 있다.


### 2. 메시지 브로커로서의 역할
MSA에서 서로 다른 서비스 간 지속적 통신이 필요할 수도 있다. 이런 경우, MQ나 stream 같은 메시지 브로커를 이용해 서비스 사이에 비동기적으로 데이터를 전달할 수 있는 통신 채널을 구현하는 것이 좋다.


Redis Pub/Sub 기능을 사용하여 간단하고 빠르게 동작하는 메시징 모델을 만들 수 있다. 물론, 한정된 메시지 시멘틱으로 인해 모든 메세징에 도입할 수 있는 것은 아니다.


또한, Redis `list` 자료구조는 메시징 큐로 사용하기 적합하다. 빠르게 `PUSH`, `POP` 연산을 수행할 수 있고, 큐에 새로운 데이터가 차기를 기다리는 블로킹 기능도 사용할 수 있다.


stream 자료구조를 이용하면 레디스를 완벽한 스트림 플랫폼으로 사용할 수도 있다. stream은 아파치 카프카 시스템에서 영감을 받아 만들어진 자료구조로, 데이터를 계속해서 append-only 하는 방식으로 저장된다.
- 소비자와 소비자 그룹 개념도 있어서 데이터의 분산 처리나 시간대별 검색 등도 제공한다.